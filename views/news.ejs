<meta name="csrf-token" content="<%= csrfToken %>">

<div class="row">
  
  <div class="col-lg-12">
    <div class="panel panel-default">
      <div class="panel-heading">جميع المصادر المتاحة</div>
      <!-- /.panel-heading -->
      <div class="panel-body">
        <table class="table table-striped table-bordered table-hover">
          <thead>
              <tr>
                  <th>#</th>
                  <th>الخبر</th>
                  <th>التاريخ</th>
                  <th>المصدر</th>
                  <th></th>
              </tr>
          </thead>
          <tbody>
              <% news.forEach(item => { %>
              <tr class="odd gradeX" id="news-row-<%= item.news_id %>">
                  <td><%= item.news_id %></td>
                  <td><%= item.news_title %></td>
                  <td><%= item.news_date %></td>
                  <td><%= item.source_name %></td>
                  <td>
                      <a href="#" class="share-telegram" data-id="<%= item.news_id %>">
                          <% if (parseInt(item.is_published) === 1) { %>
                              <i class="fa fa-check"></i> <!-- Show checkmark if published -->
                          <% } else { %>
                              <i class="fa fa-share"></i> <!-- Show share icon if not published -->
                          <% } %>
                      </a>
                  </td>
              </tr>
              <% }); %>
          </tbody>
      </table>
      
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script>
      $(document).ready(function() {
          $.ajaxSetup({
              headers: {
                  'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
              }
          });
      
          $('.share-telegram').on('click', function(event) {
              event.preventDefault();
              
              const newsId = $(this).data('id');
              const $icon = $(this).find('i');
      
              $.ajax({
                  url: `/share/telegram/${newsId}`,
                  type: 'POST',
                  success: function(response) {
                      if (response.success) {
                          // Update the icon to a checkmark
                          $icon.removeClass('fa-share').addClass('fa-check');
                          alert('Post shared to Telegram successfully!');
                      } else {
                          alert(response.message || 'Failed to post to Telegram.');
                      }
                  },
                  error: function(xhr, status, error) {
                      console.error('AJAX Error:', status, error);
                      alert('An error occurred. Please try again later.');
                  }
              });
          });
      });
      </script>
      
      
        <div class="row">
          <div class="col-sm-6"></div>
          <div class="col-sm-6">
            <div
              class="dataTables_paginate paging_simple_numbers"
              id="dataTables-news_paginate"
            >
              <ul class="pagination">
                <% if (currentPage > 1) { %>
                <li
                  class="paginate_button previous"
                  aria-controls="dataTables-news"
                  tabindex="0"
                  id="dataTables-news_previous"
                >
                  <a href="/news?page=<%= currentPage - 1 %>">Previous</a>
                </li>
                <% } %> <% for (let i = 1; i <= totalPages; i++) { %>
                <li
                  class="paginate_button <%= currentPage == i ? 'active' : ''%>"
                  aria-controls="dataTables-news"
                  tabindex="0"
                >
                  <a href="/news?page=<%= i %>"><%= i %></a>
                </li>
                <% } %> <% if (currentPage < totalPages) { %>
                <li
                  class="paginate_button next"
                  aria-controls="dataTables-news"
                  tabindex="0"
                  id="dataTables-news_next"
                >
                  <a href="/news?page=<%= currentPage + 1 %>">Next</a>
                </li>
                <% } %>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
  </div>
  <!-- /.col-lg-12 -->
</div>
<!-- /.row -->

<style>
  .fa-check{
    color: green !important;
  }
</style>

<!-- Modal -->
<div
  id="myModal"
  class="modal fade"
  tabindex="-1"
  role="dialog"
  aria-labelledby="myModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-hidden="true"
        >
          &times;
        </button>
        <h4 class="modal-title" id="myModalLabel">صورة الخبر</h4>
      </div>
      <div class="modal-body">
        <img id="modalImage" src="" width="100%" />
      </div>
      <div class="modal-footer">
        <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">
          إغلاق
        </button>
      </div>
    </div>
  </div>
</div>
