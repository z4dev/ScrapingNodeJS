<div class="row">
  <div class="col-lg-12">
    <div class="panel panel-default">
      <div class="panel-heading">جميع المصادر المتاحة</div>
      <!-- /.panel-heading -->
      <div class="panel-body">
        <table
          class="table table-striped table-bordered table-hover"
          id="dataTables-sources"
        >
          <thead>
            <tr>
              <th>#</th>
              <th>الاسم</th>
              <th>الرابط</th>
              <th>عدد الأخبار</th>
            </tr>
          </thead>
          <tbody>
            <% sources.forEach(source => { %>
            <tr class="odd gradeX">
              <td><%= source.source_id %></td>
              <td><%= source.source_name %></td>
              <td><%= source.source_url %></td>
              <td style="display: flex; justify-content: space-between; align-items: center;"><%= source.news_count %> 
                <button class="fa fa-reload fa-refresh btn-scraper"></button>

              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
      <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
  </div>
  <!-- /.col-lg-12 -->
</div>
<!-- /.row -->


<script>
  document.querySelector(".btn-scraper").addEventListener("click", async () => {
    try {
      const response = await fetch("/sources/scrap", {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
        },
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data = await response.json(); 
      const newsCount = data.newsCount;
      const isFetching = data.isFetching;
    
      if (isFetching) {
        alert(`تم جلب ${newsCount} خبر جديد`);
        window.location.reload();
      }
      else{
        alert("لا يوجد أخبار جديدة");
        window.location.reload();
      }
    
   
      
      

    } catch (error) {
      console.error("Error fetching the data:", error);
    }
  });
</script>

